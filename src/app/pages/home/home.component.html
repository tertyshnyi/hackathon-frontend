<div class="container">
  <!-- User Menu Overlay -->
  <div class="user-menu-overlay" [class.active]="isUserMenuOpen" (click)="closeUserMenu()"></div>

  <!-- Mobile Header -->
  <header class="mobile-header">
    <button class="hamburger-btn" (click)="toggleSidebar()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 12H21M3 6H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <span class="mobile-title">Explorer</span>
    <button class="user-btn mobile-user-btn" (click)="toggleUserMenu()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </header>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" [class.active]="isSidebarOpen" (click)="closeSidebar()"></div>

  <!-- Sidebar -->
  <aside class="sidebar" [class.open]="isSidebarOpen">
    <div class="sidebar-top">
      <!-- User Menu -->
      <div class="user-menu-container">
        <button class="user-btn" (click)="toggleUserMenu()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <span class="username">{{ username }}</span>
        
        <!-- Dropdown Menu -->
        <div class="user-dropdown" [class.active]="isUserMenuOpen">
          <button class="logout-btn" (click)="logout()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 17L21 12L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Log out</span>
          </button>
        </div>
      </div>
    </div>

    <div class="sidebar-header">
      <button class="close-sidebar-btn" (click)="closeSidebar()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="new-chat-btn" (click)="clearSelection(); closeSidebar()">
        <app-location-icon [size]="24"></app-location-icon>
        <span>New Search</span>
      </button>
    </div>
    
    <div class="history-section">
      <div class="history-label">Search History</div>
      <div *ngIf="isLoading" class="loading-state">
        <span class="loading-text">Loading...</span>
      </div>
      <ul *ngIf="!isLoading" class="history-list">
        <li 
          *ngFor="let item of historyItems"
          class="history-item" 
          [class.active]="selectedItem?.id === item.id"
          (click)="selectItem(item); closeSidebar()">
          <app-location-icon class="chat-icon" [size]="18"></app-location-icon>
          <span class="history-title">{{ getItemTitle(item) }}</span>
        </li>
      </ul>
      <div *ngIf="!isLoading && historyItems.length === 0" class="empty-state">
        <span class="empty-text">No search history yet</span>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="chat-area">
      <div *ngIf="selectedItem" class="selected-query">
        <div class="query-header">
          <span *ngIf="selectedItem.createdAt" class="query-date">{{ selectedItem.createdAt | date:'dd MMM yyyy, HH:mm' }}</span>
        </div>
        <div class="query-content">
          <div class="user-message">
            <div class="message-text">{{ selectedItem.query }}</div>
          </div>
        </div>
      </div>
      
      <div *ngIf="!selectedItem" class="welcome-screen">
        <div class="logo">
          <app-location-icon [size]="64" [strokeWidth]="1.5"></app-location-icon>
        </div>
        <h1 class="welcome-title">Where would you like to go today?</h1>
        <p class="welcome-subtitle">Discover places to visit, eat, or explore</p>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <textarea 
          class="message-input"
          [(ngModel)]="userInput"
          placeholder="Search for places to visit, restaurants, attractions..."
          (keydown.enter)="onEnter($event)"
          (input)="autoResize($event)"
          [disabled]="isSending"
          rows="1"></textarea>
        <button 
          class="send-btn" 
          [disabled]="!userInput.trim() || isSending" 
          (click)="sendMessage()">
          <svg *ngIf="!isSending" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span *ngIf="isSending" class="loading-spinner"></span>
        </button>
      </div>
    </div>
  </main>
</div>
